<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINGYJ - 캘린더</title>

    <!-- FullCalendar 및 Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* FullCalendar의 버튼 색상 및 스타일 수정 */
    .fc-button {
        background-color: #1a237e !important; /* 남색 */
        color: white !important; /* 버튼 텍스트 색상 */
        border: none !important; /* 테두리 제거 */
        padding: 10px 15px !important;
        border-radius: 5px !important;
    }

    .fc-button:hover {
        background-color: #303f9f !important; /* 남색 호버 색상 */
        color: white !important; /* 호버 시 텍스트 색상 */
    }

    .fc-button-active {
        background-color: #0d1b6e !important; /* 클릭된 버튼 색상 */
        color: white !important; /* 클릭된 버튼 텍스트 색상 */
    }

    .fc-button-primary {
        background-color: #1a237e !important; /* 남색 기본 색상 */
        color: white !important;
    }

    .fc-button-primary:hover {
        background-color: #303f9f !important; /* 호버 시 색상 */
    }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
        }

        header {
            background-color: #1a237e; /* 남색 배경 */
            color: white;
            text-align: center;
            padding: 20px 0;
        }

        h1 {
            margin: 0;
            font-size: 2em;
        }

        .form-container, .calendar-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .form-container h2, .calendar-container h2 {
            margin-top: 0;
            font-size: 1.5em;
        }

        label {
            font-weight: bold;
        }

        input[type="text"], input[type="description"] {
            width: 100%;
            padding: 8px;
            margin: 8px 0 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background-color: #1a237e; /* 남색 배경 */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #303f9f; /* 남색 버튼 호버 색상 */
        }

        .calendar-list {
            list-style-type: none;
            padding-left: 0;
        }

        .calendar-list li {
            background-color: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-list button {
            background-color: #f44336;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .calendar-list button:hover {
            background-color: #d32f2f;
        }

        .calendar-list a {
            text-decoration: none;
            background-color: #2196F3;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .calendar-list a:hover {
            background-color: #1976D2;
        }

        #calendar {
            margin-top: 30px;
        }

        .calendar-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .calendar-actions button {
            margin-right: 10px;
        }
    </style>

    <script>
        // 캘린더 초기화
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,weekGridWeek'
                }
            });
            calendar.render();

            // 기존 캘린더 데이터 로드
            axios.get("/api/calendars")
                .then(response => {
                    const calendars = response.data;
                    const calendarEvents = calendars.map(calendar => ({
                        title: calendar.name,
                        start: '2025-01-01', // 날짜는 실제 데이터로 변경해야 함
                        description: calendar.description
                    }));
                    calendar.addEventSource(calendarEvents); // FullCalendar에 이벤트 추가

                    // 캘린더 목록 동적으로 추가
                    const calendarList = document.getElementById("calendar-list");
                    calendars.forEach(calendar => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <strong>${calendar.name}</strong><br>
                            ${calendar.description}
                            <div>
                                <button onclick="deleteCalendar(${calendar.id})">삭제</button>
                                <a href="/api/calendars/${calendar.id}">조회</a>
                            </div>
                        `;
                        calendarList.appendChild(listItem);
                    });
                })
                .catch(error => console.error("캘린더 로드 실패:", error));
        });

        // 캘린더 생성 API 호출
        async function createCalendar() {
            const title = document.getElementById("calendar-title").value;
            const description = document.getElementById("calendar-description").value;

            if (title.length > 13) {
                alert("캘린더 제목은 최대 12글자까지 가능해요!");
                return;
            }

            try {
                const response = await axios.post("/calendars", {
                    title: title,
                    description: description
                });
                alert("캘린더가 성공적으로 생성되었습니다! : " + response.data.name);
                document.getElementById("calendar-title").value = "";
                document.getElementById("calendar-description").value = "";
                location.reload(); // 페이지 새로 고침하여 새 캘린더 목록 로드
            } catch (error) {
                console.error(error);
                alert("캘린더 생성에 오류가 발생했어요!");
            }
        }

        // 캘린더 삭제 API 호출
        async function deleteCalendar(calendarId) {
            const confirmed = confirm("정말 이 캘린더를 삭제하시겠습니까?");
            if (confirmed) {
                try {
                    await axios.delete(`/api/calendars/${calendarId}`);
                    alert("캘린더가 삭제되었습니다.");
                    location.reload(); // 페이지 새로 고침하여 삭제된 항목 갱신
                } catch (error) {
                    console.error(error);
                    alert("삭제에 실패했습니다.");
                }
            }
        }
    </script>

</head>
<body>

<header>
    <h1>캘린더 관리</h1>
</header>

<div class="form-container">
    <h2>새로운 캘린더 만들기</h2>
    <form onsubmit="event.preventDefault(); createCalendar();">
        <label for="calendar-title">캘린더 제목 :</label><br>
        <input type="text" id="calendar-title" name="title" maxlength="13" required><br><br>

        <label for="calendar-description">캘린더 설명 :</label><br>
        <input type="text" id="calendar-description" name="description"><br><br>

        <button type="submit">캘린더 만들기</button>
    </form>

    <!-- 캘린더 삭제/조회 버튼 추가 -->
    <div class="calendar-actions">
        <button onclick="deleteCalendar(1)">삭제 버튼</button>
        <button onclick="window.location.href='/api/calendars/1'">조회 버튼</button>
    </div>
</div>

<div class="calendar-container">
    <h2>캘린더 표시</h2>
    <div id="calendar"></div>
</div>

<!-- 기존 캘린더 목록 -->
<div class="form-container">
    <h2>기존 캘린더 목록</h2>
    <ul id="calendar-list" class="calendar-list">
        <!-- 캘린더 목록은 여기에 동적으로 추가됩니다. -->
    </ul>
</div>

</body>
</html>